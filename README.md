# 分子細胞生物学実験 – ミドリゾウリムシ体内にいるシアノバクテリアの個体数を面積で推定するコード –

> [!CAUTION]
> プログラムは厳密にいうとシアノバクテリアの個体数ではなく，クロロフィルにある色素の赤色蛍光を測ったものです．

## ゾウリムシ１個体あたりのクロロフィル赤色蛍光密度の測定方法
1. 手動で赤色蛍光の画像内にあるゾウリムシ１個体の細胞壁内側に内接する最も大きい四角形をとる（これによりゾウリムシ１個体の面積を近似したものとする．）
2. その部分を切り取りpng画像で保存する（png画像で保存する際に切り取った周り部分が透過するようにする）
3. この手動切り取り作業を全ての画像において行う（１枚の画像に複数個体いる場合はそれら全てにおいて切り取り作業を行う）
4. ゾウリムシ１個体を近似している切り取った四角形のピクセルRGBチャンネルよりRの値をグレースケールで取得する（これにより赤色蛍光の強さを反映，[OpenCV](https://opencv.org/)を利用）
5. 画像全体で10x10 pxの四角形をランダムにとる（この時にpng画像で透過している部分はグレースケール値が0になるため，それを含む10x10 pxは解析対象に入れない．そうすることで切り取ったゾウリムシ１個体を反映する部分のみで赤色蛍光の解析が可能である．）
6. 5を100回繰り返す
7. 取得された100個の10x10 px中にあるピクセル１つずつのグレースケール値（1-255）をそのまま赤色蛍光の強弱として，平均値を算出する
8. 4-7の作業を特定の株の特定のシアノバクテリア濃度において，全ての画像（つまり全てのゾウリムシ個体）で行う
7. 8で得た全ての画像の平均値の平均値をさらに出す
8. 7で求めた平均値を10x10 px（つまり10^2）で割る（これにより，その濃度においてゾウリムシ１個体内の平均赤色蛍光の密度を求める．）
9. 一連の作業を全ての株，シアノバクテリア濃度において行う
10. 取得したデータをcsvファイルとして出力する
11. 各自のソフトウェアで必要なグラフ等を作成する（[グラフの例](./final_analysis_zourimushi/)と[プロットに使用したRのコード](./final_analysis_zourimushi/cyano_plotting_average_included.R)）

追記: 4-8を行う実際のプログラムは[こちら](./codes/analysis3.py)

参考: 1の切り取り作業の例（作業は[Figma](https://help.figma.com/hc/ja/articles/360040675194-%E7%94%BB%E5%83%8F%E3%81%AE%E3%83%88%E3%83%AA%E3%83%9F%E3%83%B3%E3%82%B0)を使用した）<br>
<img width="431" alt="Screenshot 2024-12-29 at 18 57 06" src="https://github.com/user-attachments/assets/3f5f0a5a-98d3-4eb0-a0e5-1657c2ed737a" />


# プログラムの使い方 
## 前提
- Pythonのインストールはご自分で, Macならデフォルトで入ってるはず, バージョンが古いかもだけど
- このレポジトリを clone
- Python仮想環境がある (PCのglobal環境に直接パッケージとかインストールしてもいいなら必要ない)
  - 仮想環境の構築方法は[こちら](https://qiita.com/shun_sakamoto/items/7944d0ac4d30edf91fde)から
  - 記事に載ってるrequirements.txtに関しては以下で説明

## 必要なパッケージをインストール
1. rootディレクトリで`source bin/activate`して仮想環境を開始 (停止する時はrootディレクトリで`deactivate`)
2. `pip3 install -r requirements.txt`でパッケージたちをインストール

## コードを実行
1. `/codes`ディレクトリへ行く
2. `analysis3.py`を実行する（他のコードやファイルは遺産）

追記：画像はすでに作者が切り取ったものが入っているため，任意の画像を利用する場合はディレクトリの指定を変更してください．

# 作成者
[@yuyu_lab_tmu](https://x.com/yuyu_lab_tmu) aka 木須 雄士郎

